---
title: "MATH9102-W3-Correlation"
author: "Deirdre Lawless"
format: 
  html:
      self-contained: true
      code-fold: true
editor: visual
---

# 0. Install and Load Packages

```{r}
#| label: install-and-load
#| message: false
#| warning: false

quiet_library <- function(pkg) {
  suppressMessages(suppressWarnings({
    if (!requireNamespace(pkg, quietly = TRUE)) {
      install.packages(pkg, quiet = TRUE)
    }
    library(pkg, character.only = TRUE)
  }))
}

quiet_library("tidyverse")  # Collection of R packages (dplyr, ggplot2, tidyr, etc.) for data wrangling, visualization, and analysis
quiet_library("pastecs")    # Tools for descriptive statistics, time series analysis, and data exploration (e.g., stat.desc)
quiet_library("FSA")        # Includes general tools for data analysis (e.g., nonparametric tests, bootstrapping)
quiet_library("semTools")   # Supplementary functions for Structural Equation Modeling (SEM), including model fit, reliability, and measurement invariance tests
quiet_library("VIM") # Visualization and Imputation of Missing Values
quiet_library("naniar") #(naniar short for NA + naniar) - Missing data wrangling plus Little's test

#Amend this to reflect your folder structure 
datalocation <- file.path("C:","Users", "deirdre.lawless", "datafiles")
datapath <- file.path(datalocation,'survey.dat')

#Read in the dataset
survey <- read.table(datapath)

#Setting the column names to be that used in the dataset but in lowercase to make life a bit easier
colnames(survey) <- tolower(colnames(survey))

```

# 1. Introduction

This statistical analysis examined whether a range of psychological factors influence individuals’ psychological well-being. The dataset consisted of responses from 439 participants who completed a survey as part of a study on factors affecting psychological adjustment and wellbeing. The survey was distributed to members of the general public in Melbourne, Australia, and the surrounding districts.

The survey included a set of validated psychological scales commonly used in the literature on stress and coping to capture factors that influence individuals’ experience of stress and wellbeing. These scales measured constructs such as self-esteem, optimism, perceptions of control, perceived stress, positive and negative affect, and life satisfaction. In addition, a measure of socially desirable responding was included to account for response bias.

Composite variables were created for each construct through dimension reduction techniques, with details of the variables and the instruments used to generate them provided in Table 1.

To address the research question — Does optimism predict life satisfaction, controlling for stress and self-esteem? — before building a predictive model the following pairwise correlations were investigated:

-   **Optimism and life satisfaction**
-   **Stress and life satisfaction**
-   **Self-esteem and life satisfaction**

The data for Total Optimism, Life Satisfaction, Stress, and Self-esteem scores were examined for normality, with the outcomes presented in Section 2. The hypotheses concerning their relationships were tested, and the results are discussed in Section 3. Conclusions drawn from these findings are reported in Section 4.

| Concept | Measurement Instrument Used | Variable Type |
|---------------------|---------------------------------|------------------|
| Stress | 10 item Perceived Stress test developed by Cohen, Kamarck and Mermelstein (1983) | Continuous |
| Optimism | 6 item Life Orientation Test instrument developed by Scheier and Carver (1985) | Continuous |
| Life Satisfaction | 5 item Satisfaction with Life instrument developed by Diener, Emmons, Larson and Griffin (1985) | Continuous |
| Self-esteem | 10 item Self-esteem test instrument developed by Rosenberg (1965) | Continuous |

::: {style="text-align: center;"}
**Table 1: Psychological Factors Included in Survey**
:::

# 2. Dataset description

The data for each of the concepts of interest (scores for total optimism, total perceived stress total self-esteem, total life satisfaction) was inspected to establish whether the level of missing data represented a source of bias. Using the guidance of Tabachnick and Fidell (2016) neither the proportion nor pattern of missing data represent a source of concern see Figure 1. Little’s MCAR test was non-significant, χ²(10) = 8.07, p = .62, indicating that the data can be considered missing completely at random (MCAR). Therefore, data with missing values were removed prior to analysis.

```{r}
#| label: missing-data

varsint <- c("toptim","tpstress","tslfest","tlifesat")

# create a subset with only variables of interest
sdatasubset <- survey[varsint]

# rename columns to human-friendly labels
colnames(sdatasubset) <- c("Optimism", "Stress", "Self.Est", "LifeSat")

# run VIM::aggr
res <- summary(VIM::aggr(sdatasubset, sortVar = TRUE, combined = FALSE))$combinations

title(sub = "Figure 1: Missing Data Pattern for Psychological Concepts of Interest",
      cex.sub = 1,   # text size
      font.sub = 2)  # bold

# Little's test for mcar
naniar::mcar_test(sdatasubset)

# As we are satisfied that missing data will not interfere with our analysis, we can remove it

survey <- na.omit(survey)
```


```{r}
#| label: describe-toptim
#| warning: false

#Create a histogram
ggplot(survey, aes(x = toptim)) +
  geom_histogram(
    binwidth = 2,
    colour = "black",
    aes(y = ..density.., fill = ..count..)
  ) +
  scale_fill_gradient("Count", low = "#DCDCDC", high = "#7C7C7C") +
  stat_function(
    fun = dnorm,
    color = "red",
    args = list(
      mean = mean(survey$toptim, na.rm = TRUE),
      sd = sd(survey$toptim, na.rm = TRUE)
    )
  ) +
  labs(
    caption = "Figure 1: Histogram for Total Optimism"
  ) +
  theme(
    plot.caption = element_text(
      hjust = 0.5,            # center
      face = "bold",          # bold
      size = 14               # adjust size
    )
  )



#Create a qqplot
qqnorm(survey$toptim, main="Figure 2: QQ Plot for Total Optimism") 
qqline(survey$toptim, col=2) #show a line on the plot

#Generate summary statistics
#stat.desc is a function from pastecs - make sure you include the basic switch=F to ensure you don't get scientific notation
pastecs::stat.desc(survey$toptim, basic=F)

#We can make our decision based on the value of the standardised score for skew and kurtosis
#We divide the skew statistic by the standard error to get the standardised score
#This will indicate if we have a problem
tpskew<-semTools::skew(survey$toptim)
tpkurt<-semTools::kurtosis(survey$toptim)
tpskew[1]/tpskew[2]
tpkurt[1]/tpkurt[2]


#And also by calculating the percentage of standardised scores for the variable itself that are outside our acceptable range, This will tell us how big a problem we have
# Calculate the percentage of standardized scores that are greater than 1.96
# the perc function which is part of the FSA package which calculate the percentage that are within a range - you can look for greater than "gt", greater than or equal "geq", "gt", less than or equal "leq",  or less than "lt"),
# scale is a function that creates z scores, abs gets absolute value

ztoptim<- abs(scale(survey$toptim))

FSA::perc(as.numeric(ztoptim), 1.96, "gt")
FSA::perc(as.numeric(ztoptim), 3.29, "gt")
# Below we are reporting the normality assessment - embedding code within a paragraph to get the statistics generated ( you can just write it out)
```

Total Optimism scores were assessed for normality. Visual inspection of the histogram and QQ-Plot (see Figure 1 and Figure 2) identified some issues with skewness and kurtosis. While the standardized score for kurtosis (`r round(tpkurt[1]/tpkurt[2],2)`) could be considered acceptable using the criteria proposed by Curran, West and Finch (1996), the standardized score for skewness (`r round(tpskew[1]/tpskew[2],2)`) was outside the acceptable range. However as over 99% of standardized scores fall within the bounds of +/- 3.29, using the guidance of Field, Miles and Field (2013), the data can be considered to approximate a normal distribution (m=`r round(mean(survey$toptim, na.rm=TRUE),2)`, sd=`r round(sd(survey$toptim, na.rm=TRUE),2)`, n=`r length(survey$toptim)-sum(is.na(survey$toptim))`).

```{r}
#| label: describe-tpstress
#| warning: false

#Create histogram
ggplot(survey, aes(x = tpstress)) +
  geom_histogram(
    binwidth = 2,
    colour = "black",
    aes(y = ..density.., fill = ..count..)
  ) +
  scale_fill_gradient("Count", low = "#DCDCDC", high = "#7C7C7C") +
  stat_function(
    fun = dnorm,
    color = "red",
    args = list(
      mean = mean(survey$tpstress, na.rm = TRUE),
      sd = sd(survey$tpstress, na.rm = TRUE)
    )
  ) +
  labs(
    caption = "Figure 3: Histogram for Total Perceived Stress"
  ) +
  theme(
    plot.caption = element_text(
      hjust = 0.5,   # center
      face = "bold", # bold
      size = 14      # adjust size
    )
  )


#Create a qqplot
qqnorm(survey$tpstress, main="Figure 4: QQPlot for Total Perceived Stress")
qqline(survey$tpstress, col=2) #show a line on the plot


#Generate regular summary statistics 
pastecs::stat.desc(survey$tpstress, basic=F)

#Generate standardized scores for skewness and kurtosis
tpskew<-semTools::skew(survey$tpstress)
tpkurt<-semTools::kurtosis(survey$tpstress)
tpskew[1]/tpskew[2]
tpkurt[1]/tpkurt[2]

#Calculate the percentage of standardized scores outside acceptable limits
ztpstress<- abs(scale(survey$tpstress))
FSA::perc(as.numeric(ztpstress), 1.96, "gt")
FSA::perc(as.numeric(ztpstress), 3.29, "gt")
```

Total Perceived Stress scores were assessed for normality. Visual inspection of the histogram and QQ-Plot (see Figure 3 and Figure 4) identified some issues with skewness and kurtosis. While the standardized score for kurtosis (`r round(tpkurt[1]/tpkurt[2],2)`) could be considered acceptable using the criteria proposed by Curran, West and Finch (1996), the standardized score for skewness (`r round(tpskew[1]/tpskew[2],2)`) was slightly outside the acceptable range. However as over 99% of standardized scores fall within the bounds of +/- 3.29, using the guidance of Field, Miles and Field (2012), the data can be considered to approximate a normal distribution (m=`r round(mean(survey$tpstress, na.rm=TRUE),2)`, sd=`r round(sd(survey$tpstress, na.rm=TRUE),2)`, n=`r length(survey$tpstress)-sum(is.na(survey$tpstress))`).

```{r}
#| label: describe-tslfest

#Create histogram
ggplot(survey, aes(x = tslfest)) +
  geom_histogram(
    binwidth = 2,
    colour = "black",
    aes(y = ..density.., fill = ..count..)
  ) +
  scale_fill_gradient("Count", low = "#DCDCDC", high = "#7C7C7C") +
  stat_function(
    fun = dnorm,
    color = "red",
    args = list(
      mean = mean(survey$tslfest, na.rm = TRUE),
      sd = sd(survey$tslfest, na.rm = TRUE)
    )
  ) +
  labs(
    caption = "Figure 5: Histogram for Total Self-Esteem"
  ) +
  theme(
    plot.caption = element_text(
      hjust = 0.5,   # center
      face = "bold", # bold
      size = 14      # adjust size
    )
  )

#Create a qqplot
qqnorm(survey$tslfest, main="Figure 6: QQ Plot for Self-Esteem") 
qqline(survey$tslfest, col=2) #show a line on the plot

#Generate summary statistics
pastecs::stat.desc(survey$tslfest, basic=F)

#Calculate the standardized score for skew and kurtosis
tpskew<-semTools::skew(survey$tslfest)
tpkurt<-semTools::kurtosis(survey$tslfest)
tpskew[1]/tpskew[2]
tpkurt[1]/tpkurt[2]


#Calculate the percentage of standardized scores for the variable itself that are outside our acceptable range
ztslfest<- abs(scale(survey$tslfest))
FSA::perc(as.numeric(ztslfest), 1.96, "gt")
FSA::perc(as.numeric(ztslfest), 3.29, "gt")

```

Total self-esteem scores were assessed for normality. Visual inspection of the histogram and QQ-Plot (see Figure 5 and Figure 6) identified some issues with skewness and kurtosis. While the standardized score for kurtosis (`r round(tpkurt[1]/tpkurt[2],2)`) could be considered acceptable using the criteria proposed by Curran, West and Finch (1996), the standardized score for skewness (`r round(tpskew[1]/tpskew[2],2)`) was outside the acceptable range. However as 100% of standardized scores fall within the bounds of +/- 3.29, using the guidance of Field, Miles and Field (2013), the data can be considered to approximate a normal distribution (m=`r round(mean(survey$tslfest, na.rm=TRUE),2)`, sd=`r round(sd(survey$tslfest, na.rm=TRUE),2)`, n=`r length(survey$tslfest)-sum(is.na(survey$tslfest))`).

```{r}
#| label: describe-tlifesat

#Create histogram
ggplot(survey, aes(x = tlifesat)) +
  geom_histogram(
    binwidth = 2,
    colour = "black",
    aes(y = ..density.., fill = ..count..)
  ) +
  scale_fill_gradient("Count", low = "#DCDCDC", high = "#7C7C7C") +
  stat_function(
    fun = dnorm,
    color = "red",
    args = list(
      mean = mean(survey$tlifesat, na.rm = TRUE),
      sd = sd(survey$tlifesat, na.rm = TRUE)
    )
  ) +
  labs(
    x = "Total Life Satisfaction",
    caption = "Figure 7: Histogram for Total Life Satisfaction"
  ) +
  theme(
    plot.caption = element_text(
      hjust = 0.5,   # center
      face = "bold", # bold
      size = 14      # adjust size
    )
  )


#Create a qqplot
qqnorm(survey$tlifesat, main="Figure 8: QQ Plot for Total Life Satisfaction") 
qqline(survey$tlifesat, col=2) #show a line on the plot

#Generate summary statistics
pastecs::stat.desc(survey$tlifesat, basic=F)

#Calculate the standardized score for skew and kurtosis
tpskew<-semTools::skew(survey$tlifesat)
tpkurt<-semTools::kurtosis(survey$tlifesat)
tpskew[1]/tpskew[2]
tpkurt[1]/tpkurt[2]


#Calculate the percentage of standardized scores for the variable itself that are outside our acceptable range
ztlifesat<- abs(scale(survey$tlifesat))
FSA::perc(as.numeric(ztlifesat), 1.96, "gt")
FSA::perc(as.numeric(ztlifesat), 3.29, "gt")
```

Total life satisfaction scores were assessed for normality. Visual inspection of the histogram and QQ-Plot (see Figure 7 and Figure 8) identified some issues with skewness and kurtosis. While the standardized score for kurtosis (`r round(tpkurt[1]/tpkurt[2],2)`) could be considered acceptable using the criteria proposed by Curran, West and Finch (1996), the standardized score for skewness (`r round(tpskew[1]/tpskew[2],2)`) was outside the acceptable range. However as 100% of standardized scores fall within the bounds of +/- 3.29, using the guidance of Field, Miles and Field (2013), the data can be considered to approximate a normal distribution (m=`r round(mean(survey$tlifesat, na.rm=TRUE),2)`, sd=`r round(sd(survey$tlifesat, na.rm=TRUE),2)`, n=`r length(survey$tlifesat)-sum(is.na(survey$tlifesat))`).

# 3. Investigation of Hypotheses

## 3.1 Relationship between level of optimism and level of life satisfaction

H0: There is no relationship between a respondent’s level of optimism and their level of life satisfaction. 
Ha: There is a relationship between a respondent’s level of optimism and their level of life satisfaction.

```{r}
#| label: corr-optlifesat

#Create a Simple scatter plot of optimism and life satisfaction
#aes(x,y)
ggplot(survey, aes(toptim, tlifesat)) +
  geom_point() +
  geom_smooth(method = "lm", colour = "red", se = FALSE) +
  labs(x = "Total Optimism", y = "Total Life Satisfaction")

#Pearson Correlation - this is the correct test for this data - output to screen for checking
stats::cor.test(survey$toptim, survey$tlifesat, method='pearson')
#Save results in a variable
corstat<-stats::cor.test(survey$toptim, survey$tpstress, method='pearson')

```

The relationship between total optimism and life satisfaction was investigated using a Pearson correlation. A strong, statistically significant, positive correlation was found (r =`r round(as.numeric(corstat[4]),2)`, n=`r as.numeric(corstat[2])`, p\<.001). There is therefore evidence to reject the null hypothesis in favour of the alternate that there is a relationship between optimism and life satisfaction. This result indicates that as a respondent's level of optimism increases, their level of life satisfaction increases.

## 3.2 Relationship between level of perceived stress and level of life satisfaction

H0: There is no relationship between a respondent’s level of perceived stress and their level of life satisfaction. 
Ha: There is a relationship between a respondent’s level of perceived stress and their level of life satisfaction.

```{r}
#| label: corr-stresslifesat

#Create a Simple scatter plot of stress and life satisfaction
#aes(x,y)
ggplot(survey, aes(tpstress, tlifesat)) +
  geom_point() +
  geom_smooth(method = "lm", colour = "red", se = FALSE) +
  labs(x = "Total Perceived Stress", y = "Total Life Satisfaction")
 


#Pearson Correlation - this is the correct test for this data
corstat<-stats::cor.test(survey$tpstress, survey$tlifesat, method='pearson')
corstat

```

The relationship between total perceived stress and total life satisfaction was investigated using a Pearson correlation. A strong, statistically significant, negative correlation was found (r =`r round(as.numeric(corstat[4]),2)`, n=`r as.numeric(corstat[2])`, p\<.001). There is therefore evidence to reject the null hypothesis in favour of the alternate that there is a relationship between perceived stress and life satisfaction. This results indicates that as a respondent's perceived stress levels increase, their level of life satisfaction decreases.

## 3.3 Relationship between level of self-esteem and level of life satisfaction

H0: There is no relationship between a respondent’s level of self-esteem and their level of life satisfaction. 
Ha: There is a relationship between a respondent’s level of self-esteem and their level of life satisfaction.

```{r}
#| label: corr-slfestlifesat
#Create a Simple scatter plot of self-esteem and life satisfaction
#aes(x,y)
ggplot(survey, aes(tslfest, tlifesat)) +
  geom_point() +
  geom_smooth(method = "lm", colour = "red", se = FALSE) +
  labs(x = "Total Self-Esteem", y = "Total Life Satisfaction")
 


#Pearson Correlation - this is the correct test for this data
corstat=stats::cor.test(survey$tslfest, survey$tlifesat, method='pearson')
corstat

```

The relationship between total self-esteem and total life satisfaction was investigated using a Pearson correlation. A strong, statistically significant, positive correlation was found (r =`r round(as.numeric(corstat[4]),2)`, n=`r as.numeric(corstat[2])`, p\<.001). There is therefore evidence to reject the null hypothesis in favour of the alternate that there is a relationship between self-esteem and life satisfaction. The results indicate that as a respondent's level of self-esteem increases, their level of life satisfaction increases.

# 4. Conclusions

This analysis investigated the relationships between optimism, perceived stress, self-esteem, and life satisfaction using survey data from 439 respondents. Normality checks indicated some departures from the ideal distribution, but the data were deemed suitable to be treated as approximate normal distributions for Pearson correlations based on accepted criteria.

The findings showed consistent, moderate, and statistically significant relationships between the psychological factors and life satisfaction:

-   Optimism was positively correlated with life satisfaction, indicating that individuals with higher optimism reported greater satisfaction with life.

-   Perceived stress was negatively correlated with life satisfaction, suggesting that greater levels of stress are associated with reduced satisfaction.

-   Self-esteem was positively correlated with life satisfaction, supporting the idea that individuals with higher self-regard experience higher levels of well-being.

Taken together, these results provide strong evidence that optimism and self-esteem are protective factors for life satisfaction, while perceived stress represents a risk factor. The findings are consistent with established theoretical and empirical work on stress, coping, and psychological adjustment, reinforcing the importance of positive psychological resources in promoting well-being.

# References

Cohen, S., Kamarck, T. & Mermelstein, R. (1983). A global measure of perceived stress. Journal of Health and Social Behavior, 24, 385–96. Cohen, J. (1988). Statistical power analysis for the behavioral sciences (2nd ed.). Hillside, NJ: Lawrence Erlbaum Associates. Curran, Patrick J., Stephen G. West, and John F. Finch. (1996). "The robustness of test statistics to nonnormality and specification error in confirmatory factor analysis." Psychological methods 1.1 (1996): 16. Diener, E., Emmons, R.A., Larson, R.J. & Griffin, S. (1985). The Satisfaction with Life scale. Journal of Personality Assessment, 49, 71–6.\
Field, A., Field Z. & Miles J.(2012). Discovering statistics using IBM SPSS statistics. Sage publications limited. Pearlin, L. & Schooler, C. (1978). The structure of coping. Journal of Health and Social Behavior, 19, 2–21. Rosenberg, M. (1965). Society and the adolescent self-image. Princeton, NJ: Princeton University Press. Scheier, M.F. & Carver, C.S. (1985). Optimism, coping and health: An assessment and implications of generalized outcome expectancies. Health Psychology, 4, 219–47.
